---
title: Road Warrior Disaster Recovery
subtitle: Secure, Synchronized, and Backed-up
date: 2019-05-18T21:00:00Z
author: Aaron Poffenberger
email: akp@hypernote.com
institution: akp@hypernote.com
tags: security
---


# Introduction

Aaron Poffenberger

- Software developer 20+ years
   - Security-software, and secure-software, developer
- OpenBSD user since ~3.2
- Ersatz Backup Operator 20+ years


# Overview

- Origin of Talk
- What is a Disaster?
- Risk Analysis and Threat Model
- Machine Physical Security
- Data Security - Encryption
- Data Synchronization
- On-the-go Backups
- On-the-go Recovery
- Preparing to Cross International Borders


# Origin of Talk

![](640px-Castle_Bravo_Blast.jpg){ width=180px }

- That time I nuked the disklabel
- Increasing amount and importance of data on laptops


# Origin of Talk

Challenges:

- Reliable, fast backups at rest and on the go
- Easy to access and restore while travelling
- Sync home dir with other systems
- Open tools and protocols
- Available in base or packages
- No compromise security


# What is a Disaster?[^60]

![](60g_right.jpg){ height=180px }

For my purposes, a disaster is any event that prevents me from using my
laptop or accessing any of the data I need.

[^60]: OpenBSD http://www.openbsd.org/60.html


# What is a Disaster?

- Hardware failure
- Theft
- Confiscation
- `dd(1)` oopsies


# Two Sides

There are two sides to every disaster. The first question everyone asks is:

```
  How do we recover from it?
```

Few ask:

```
  What happened to the computers and data in the disaster?
```

It's just important to ensure no one can benefit from the disaster.


# Risks - Threats[^Porter]

![](Great_train_robbery_still.jpg){ height=180px }

What are the threats you face?

Ask yourself a few questions:

[^Porter]: Edwin S. Porter - The Kobal Collection, Public Domain, https://commons.wikimedia.org/w/index.php?curid=13518


# Risks - Questions

Who am I in the world?

- CEO, CTO, CFO
- System Administrator
- Developer
- Journalist, activist, gadfly


# Risks - Questions

What sensitive data do I have?

- Source code
- Access codes
- Customer data


# Risks - Questions

What access do I have that someone might want?

- Admin/root
- Personal or employer banking details
- Social media accounts
- Customer VPN credentials
- Commit bit to an interesting project


# Risks - Questions

Who wants that hardware, sensitive data, or access?

- Thieves looking for a quick buck
- Competitors
- Nation states
- Manufacturers (hardware failure)
- Self ("I left my laptop on the plane.")


# Risks - Threats

"I thought this talk was about backups. Why are we discussing
threats?"

- Knowing what can going wrong and how affects how your prepare
- But don't spend ages considering every possibility
- Take a defense in depth approach
- Security isn't a destination ... it's a process


# Machine Physical Security - BIOS

In case of loss, theft, or surreptitious access, ensure the laptop is
physically secure and tamper evident.


# Machine Physical Security - BIOS

Enable BIOS features like:

- Bottom cover open warning
- Supervisor password
- Boot OS drive only, require supervisor password to boot USB disks,
  CD ROMs or PXE


# Machine Physical Security - OS

If your OS supports it:

- Consider a `cron(8)` job that hibernates the computer every night.
  It's hard to hack past full-disk encryption.
- Lock the screen on insertion and maybe removal of USB HIDs
  (human-interface devices) like keyboards and mice.

*N.B.* If you're on OpenBSD, I wrote `hotplugd(8)` attach and remove
scripts that start `xlock(1)` when HID devices are inserted or
removed.

# Why lock the Screen when a Mouse is Attached?[^Drvec]

![](ManWearingTinFoilHat.jpg){ height=150px }

With the rise of full-disk encryption you can't just grab the disk out
of a computer and get to the data. You need it running, and logged in,
which means you need to snatch it remove the user while they're using
it.

Once snatched, you insert a mouse jiggler to "move" the mouse every
few seconds to simulate activity and prevent the lockscreen from
activating.

[^Drvec]: Drvec (talk) - Own work (Original text: self-made), Public
Domain, https://commons.wikimedia.org/w/index.php?curid=4695857


# Data Security - Encryption

![](disk_shredding.png){ height=180px }

If you're not already using full-disk encryption on your laptop,
start. It's the lynchpin of most disaster recovery planning scenarios:

- Peace of mind when computers go missing
- Reduced anxiety about throwing out old hard drives or computers


# Data Security - Encryption

Disk drives are not the only area where encryption matters:

- Some data should be encrypted at rest (*e.g.*, passwords)

Encryption is also critical for on-the-go backups and recovery:

- Learn to use OpenSSH features like **ProxyJump (-J)**.


# What's ProxyJump (-J)?

Ever wondered how to connect to your host on the other side of the
firewall? **ProxyJump**

```
  Setting this option will cause ssh(1) to connect to
  the target host by first making a ssh(1) connection
  to the specified ProxyJump host and then establishing
  a TCP forwarding to the ultimate target from there.
```

Yes, you can make multiple jumps with a comma-delimited list of
ProxyJump hosts.


# Data Synchronization

Backups are great, but they're meant for mid-to-long-term storage.

Synchronization is 

- git-annex
- rsync
- Syncthing
- Unison


# On-the-go Backups

Synchronization (and snapshots) are not the same as backups.

- Events like NotPetya


# On-the-go Backups - Utilities

- Tarsnap
- rsync
- rdiff-backup
- borg backup
- deja dup in Gnome


# On-the-go Backups - Storage

- FreeNAS

There are numerous solutions. Pick one that supports remote backup and
restore.


# On-the-go Recovery[^Santeri]

![](640px-DVD,_USB_flash_drive_and_external_hard_drive.jpg){ height=180px }

Begins with preparation.

[^Santeri]: Santeri Viinamki, CC BY-SA 4.0, https://commons.wikimedia.org/w/index.php?curid=51673237


# On-the-go Recovery

- OS Install Drive
- Recent backup - optionally, but very encouraged


# Preparing to Cross International Borders


# Risks - Mitigation[^Dany]

![](640px-Chemin_de_ronde_muraille_long.JPG){ height=180px }

Which threats can you mitigate with changes to your setup?

[^Dany]: Fabien Dany - www.fabiendany.com, CC BY-SA 2.5, https://commons.wikimedia.org/w/index.php?curid=636016


# Risks - Mitigation

Consider paring down the amount and scope of data you travel with:

- Can you archive financial records from years past?
- Can you store current financial records on system that doesn't
  travel?

*N.B.*: `sshfs` isn't as fast as local access, but it works in a pinch


# Risk Analysis - Mitigation[^Daderot]

![](640px-Arabia_Steamboat_Museum_-_Kansas_City,_MO_-_DSC07238.JPG){ height=180px }

Do you need to carry all those passwords while you travel?

[^Daderot]: Daderot - Own work, Public Domain, https://commons.wikimedia.org/w/index.php?curid=17259556


# Does it Work?

Yes, quite well.

Recent trip I took restore media and a laptop running Windows. Came
back with a laptop running OpenBSD and all my data.

That said, the plural of anecdote is not data.


# Conclusion

- You have questions, I may have answers


# Contact Details

- Aaron Poffenberger
- akp@hypernote.com
- Blog: <http://akpoff.com>
- Twitter: @akpoff
- bsd.network: @akpoff
- Amateur Radio: KG5DQJ

Slides for this presentation will be posted on my blog and BSDCan


# Credits

- [OpenBSD]
- [OpenSSH]
- [rsync] / [OpenRsync]


# Thanks

- BSDCan, Sponsors, and Volunteers


# Support OpenBSD

- <http://www.openbsdfoundation.org/>


# Further Reading

- [That time I nuked the disklabel]
- [Starting Xlock on USB HID Insertion]
- [The Untold Story of NotPetya]


# Technologies and Resources

- [OpenSSH]
- [rsync] / [OpenRsync]
- [Tarsnap]
- [Unison]
- [Wikipedia File Synchronization Comparison]


[deja dup]
[git-annex]: https://git-annex.branchable.com/
[OpenBSD]: https://www.openbsd.org/
[OpenSSH]: https://www.openssh.com/
[OpenRsync]: http://www.openrsync.org/
[rsync]: https://www.samba.org/rsync/
[sshfs]: https://github.com/libfuse/sshfs/
[Starting Xlock on USB HID Insertion]: http://akpoff.com/archive/starting_xlock_on_usb_hid_insertion.html
[Syncthing]: https://syncthing.net/
[Tarsnap]: https://www.tarsnap.com/
[That time I nuked the disklabel]: http://akpoff.com/archive/2017/that_time_i_nuked_the_disklabel_and_recovered_the_disk.html
[Unison]: https://www.cis.upenn.edu/~bcpierce/unison/
[Wikipedia File Synchronization Comparison]: https://en.wikipedia.org/wiki/Comparison_of_file_synchronization_software
[The Untold Story of NotPetya]: https://www.wired.com/story/notpetya-cyberattack-ukraine-russia-code-crashed-the-world/
